# Windows Orchestrator

[🇫🇷 フランス語](README-fr-FR.md) | [🇩🇪 ドイツ語](README-de-DE.md) | [🇪🇸 スペイン語](README-es-ES.md) | [🇮🇳 ヒンディー語](README-hi-IN.md) | [🇯🇵 日本語](README-ja-JP.md) | [🇷🇺 ロシア語](README-ru-RU.md) | [🇨🇳 中国語](README-zh-CN.md) | [🇸🇦 アラビア語](README-ar-SA.md) | [🇧🇩 ベンガル語](README-bn-BD.md) | [🇮🇩 インドネシア語](README-id-ID.md)

**専用の Windows ワークステーションの自動操縦。一度設定すれば、システムが確実に自己管理します。**

<p align="center">
  <a href="https://wo.davalan.fr/"><strong>🔗 公式ホームページで詳細をご覧ください！</strong></a>
</p>

![ライセンス](https://img.shields.io/badge/Licence-GPLv3-blue.svg)![PowerShell バージョン](https://img.shields.io/badge/PowerShell-5.1%2B-blue)![ステータス](https://img.shields.io/badge/Status-稼働中-brightgreen.svg)![OS](https://img.shields.io/badge/OS-Windows_10_|_11-informational)![サポート](https://img.shields.io/badge/Support-11_言語-orange.svg)![貢献](https://img.shields.io/badge/Contributions-歓迎-brightgreen.svg)

---

## 私たちの使命

完全に信頼性が高く自律的な Windows ワークステーションを想像してみてください。一度設定すれば、その使命のために設定され、その後は忘れてしまえるマシンです。アプリケーションが中断することなく、**常に動作し続ける**ことを保証するシステムです。

これが、**Windows Orchestrator** が達成を支援する目標です。課題は、標準的な Windows PC がこの耐久性のためにネイティブに設計されていないことです。それは人間との対話のために設計されています。つまり、スリープ状態になったり、適切と判断したときに更新をインストールしたり、再起動後にアプリケーションを自動的に再起動したりしません。

**Windows Orchestrator** は解決策です。インテリジェントで永続的な監視者として機能する一連のスクリプトです。これにより、あらゆる PC が信頼性の高い自動機械に変わり、手動での介入なしに、重要なアプリケーションが常に動作し続けることを保証します。



私たちは、1つではなく、2種類のシステム障害に直面しました。

#### 1. 突然の障害：予期せぬ停止

シナリオは単純です。リモートアクセス用に設定されたマシンと、夜間の停電。BIOS が自動再起動に設定されていても、ミッションは失敗します。Windows は再起動しますが、ログイン画面のままです。重要なアプリケーションは再起動されず、セッションは開かれません。システムはアクセス不能になります。

#### 2. 緩やかな劣化：長期的な不安定性

さらに陰湿なのは、時間の経過とともに Windows が示す動作です。対話型 OS として設計されているため、中断することなく実行されるプロセスには最適化されていません。徐々にメモリリークやパフォーマンスの低下が現れ、システムが不安定になり、手動での再起動が必要になります。

### 答え：ネイティブな信頼性レイヤー

これらの課題に直面し、サードパーティのユーティリティでは不十分であることが判明しました。そこで、**独自のシステム回復力レイヤーを構築する**ことを決定しました。

`Windows Orchestrator` は、OS を制御する自動操縦装置として機能し、次のことを行います。

- **自動回復の確保：** 障害後、セッションの開始とメインアプリケーションの再起動を保証します。
- **予防保守の保証：** カスタムスクリプトの事前実行を伴う、制御された毎日の再起動をスケジュールできます。
- Windows からの不適切な中断（更新、スリープモードなど）から**アプリケーションを保護**します。

`Windows Orchestrator` は、Windows ワークステーションが**継続的な監視なしに、信頼性が高く、安定しており、動作し続ける**必要があるすべての人にとって不可欠なツールです。

---

## 典型的な使用例

*   **デジタルサイネージ：** 公共の画面でサイネージソフトウェアが 24 時間 365 日稼働することを保証します。
*   **ホームサーバーと IoT：** Windows PC から Plex サーバー、Home Assistant ゲートウェイ、または接続されたオブジェクトを制御します。
*   **監視ステーション：** 監視アプリケーション（カメラ、ネットワークログ）を常にアクティブに保ちます。
*   **インタラクティブキオスク：** 各再起動後にキオスクアプリケーションが自動的に再起動することを保証します。
*   **軽量な自動化：** データマイニングやテストタスクのために、スクリプトやプロセスを継続的に実行します。

---

## 主な機能

*   **グラフィカル設定ウィザード：** 基本設定のためにファイルを編集する必要はありません。
*   **完全な多言語サポート：** 11 言語でインターフェースとログが利用可能で、システムの言語を自動検出します。
*   **電源管理：** マシンのスリープ、ディスプレイのスリープ、Windows 高速スタートアップを無効にして、最大限の安定性を実現します。
*   **自動ログイン：** 安全なパスワード管理のために、**Sysinternals AutoLogon** ツールと連携して自動ログインを管理します。
*   **Windows Update 制御：** 強制的な更新や再起動がアプリケーションを中断するのを防ぎます。
*   **プロセス マネージャー：** 各セッションでメインアプリケーションを自動的に起動、監視、再起動します。
*   **スケジュールされた毎日再起動：** システムの鮮度を維持するために、毎日再起動をスケジュールします。
*   **再起動前アクション：** スケジュールされた再起動の前に、カスタムスクリプト（バックアップ、クリーンアップなど）を実行します。
*   **詳細なログ記録：** すべてのアクションは、簡単な診断のためにログファイルに記録されます。
*   **通知（オプション）：** Gotify を介してステータスレポートを送信します。

---

## 対象読者とベストプラクティス

このプロジェクトは、PC を信頼性の高い自動機械に変えることを目的としており、マシンが単一のアプリケーション（IoT デバイスのサーバー、デジタルサイネージ、監視ステーションなど）に特化している使用例に最適です。一般的なオフィスや日常のコンピューターには推奨されません。

*   **主要な Windows 更新：** 重要な更新（例：Windows 10 から 11 へのアップグレード）の場合、最も安全な手順は、更新前に Windows Orchestrator を**アンインストール**し、その後**再インストール**することです。
*   **企業環境：** コンピューターがグループポリシーオブジェクト（GPO）によって管理されている企業ドメインにある場合、このスクリプトによって行われた変更が組織のポリシーと競合しないことを IT 部門に確認してください。

---

## インストールと開始

**言語に関する注意：** 起動スクリプト（`1_install.bat` および `2_uninstall.bat`）は、指示を**英語**で表示します。これは正常です。これらのファイルは単純なランチャーとして機能します。グラフィカルウィザードまたは PowerShell スクリプトが引き継ぐとすぐに、インターフェースは自動的にオペレーティングシステムの言語に適応します。

**Windows Orchestrator** の設定は、シンプルでガイド付きのプロセスです。

1.  設定するコンピューターにプロジェクトを**ダウンロード**またはクローンします。
2.  `1_install.bat` を実行します。スクリプトは 2 つのステップでガイドします。
    *   **ステップ 1：グラフィカルウィザードによる設定。**
        必要に応じてオプションを調整します。最も重要なのは、通常、自動ログインのユーザー名と起動するアプリケーションです。`保存` をクリックして保存します。
        
        ![設定ウィザード](assets/screenshot-wizard.png)
        
    *   **ステップ 2：システムタスクのインストール。**
        スクリプトは続行の確認を求めます。Windows セキュリティ（UAC）ウィンドウが開きます。必要なスケジュールされたタスクを作成するために、**これを受け入れる必要があります**。
3.  これで完了です！次回の再起動時に、設定が適用されます。

---

## 設定
いつでも 2 つの方法で設定を調整できます。

### 1. グラフィカルウィザード（簡単な方法）
`1_install.bat` を再実行して、設定インターフェースを再度開きます。設定を変更して保存します。

### 2. `config.ini` ファイル（高度な方法）
テキストエディターで `config.ini` を開いて、詳細な制御を行います。

#### 自動ログインとパスワードに関する重要な注意
セキュリティ上の理由から、**Windows Orchestrator はパスワードをプレーンテキストで管理または保存することはありません。** 自動ログインを効果的かつ安全に設定する方法は次のとおりです。

*   **シナリオ 1：ユーザーアカウントにパスワードがない場合。**
    グラフィカルウィザードまたは `config.ini` ファイルの `AutoLoginUsername` にユーザー名を入力するだけです。

*   **シナリオ 2：ユーザーアカウントにパスワードがある場合（推奨される方法）。**
    1.  Microsoft から公式の **[Sysinternals AutoLogon](https://download.sysinternals.com/files/AutoLogon.zip)** ツールをダウンロードします（直接ダウンロードリンク）。
    2.  AutoLogon を起動し、ユーザー名、ドメイン、パスワードを入力します。このツールは、パスワードをレジストリに安全に保存します。
    3.  **Windows Orchestrator** の設定では、`AutoLoginUsername` フィールドを空のままにすることができます（スクリプトは、対応するレジストリキーを読み取ることにより、AutoLogon によって設定されたユーザーを検出します）、または念のため入力することもできます。当社のスクリプトは、`AutoAdminLogon` レジストリキーが適切に有効になっていることを確認して、設定を完了します。

#### 高度な設定：`PreRebootActionCommand`
この強力な機能により、毎日再起動する前にスクリプトを実行できます。パスは次のいずれかです。
- **絶対パス：** `C:\Scripts\my_backup.bat`
- **プロジェクトに対する相対パス：** `PreReboot.bat`（スクリプトはプロジェクトのルートでこのファイルを検索します）。
- **`%USERPROFILE%` の使用：** `%USERPROFILE%\Desktop\cleanup.ps1`（スクリプトは `%USERPROFILE%` を自動ログインユーザーのプロファイルへのパスにインテリジェントに置き換えます）。

---

## プロジェクト構造
```
WindowsOrchestrator/
├── 1_install.bat                # インストールと設定のエントリポイント
├── 2_uninstall.bat              # アンインストールのエントリポイント
├── config.ini                   # 中央設定ファイル
├── config_systeme.ps1           # マシン設定のメインスクリプト（起動時に実行）
├── config_utilisateur.ps1       # ユーザープロセス管理のメインスクリプト（ログイン時に実行）
├── LaunchApp.bat                # (例) メインアプリケーションのポータブルランチャー
├── PreReboot.bat                # 再起動前アクションのサンプルスクリプト
├── Logs/                        # (自動作成) ログファイルを含む
├── i18n/                        # すべての翻訳ファイルを含む
│   ├── en-US/strings.psd1
│   └── ... (その他の言語)
└── management/
    ├── defaults/default_config.ini # 初期設定テンプレート
    ├── tools/                   # 診断ツール
    │   └── Find-WindowInfo.ps1
    ├── firstconfig.ps1          # グラフィカル設定ウィザードのコード
    ├── install.ps1              # タスクインストールの技術スクリプト
    └── uninstall.ps1            # タスク削除の技術スクリプト
```

---

## 詳細な操作
**Windows Orchestrator** の核は、Windows タスクスケジューラに依存しています。

1.  **Windows 起動時**
    *   `WindowsOrchestrator_SystemStartup` タスクは `SYSTEM` 権限で実行されます。
    *   `config_systeme.ps1` スクリプトは `config.ini` を読み取り、すべてのマシン設定を適用します。また、再起動タスクの作成/更新も管理します。

2.  **ユーザーログイン時**
    *   `WindowsOrchestrator_UserLogon` タスクが実行されます。
    *   `config_utilisateur.ps1` スクリプトは `config.ini` の `[Process]` セクションを読み取り、メインアプリケーションが適切に起動されていることを確認します。すでに実行中の場合は、最初に停止してからクリーンに再起動されます。

3.  **毎日（設定されている場合）**
    *   `WindowsOrchestrator_PreRebootAction` タスクは、バックアップ/クリーンアップスクリプトを実行します。
    *   数分後、`WindowsOrchestrator_ScheduledReboot` タスクがコンピューターを再起動します。

---

### 診断および開発ツール

プロジェクトには、プロジェクトの設定と保守に役立つ便利なスクリプトが含まれています。

*   **`management/tools/Find-WindowInfo.ps1`**：アプリケーションのウィンドウの正確なタイトルがわからない場合（たとえば、`Close-AppByTitle.ps1` で設定する場合）、このスクリプトを実行します。すべての表示されているウィンドウとそのプロセス名が一覧表示され、正確な情報を見つけるのに役立ちます。
*   **`Fix-Encoding.ps1`**：スクリプトを変更する場合、このツールは、PowerShell 5.1 および国際文字との完全な互換性のために、正しいエンコーディング（BOM 付き UTF-8）で保存されていることを保証します。

---

## ログ記録
トラブルシューティングを容易にするために、すべてがログに記録されます。
*   **場所：** `Logs/` サブフォルダー内。
*   **ファイル：** `config_systeme_ps_log.txt` および `config_utilisateur_log.txt`。
*   **ローテーション：** 古いログは、大きくなりすぎないように自動的にアーカイブされます。

---

## アンインストール
システムを削除するには：
1.  `2_uninstall.bat` を実行します。
2.  **特権要求（UAC）を受け入れます**。
3.  スクリプトは、すべてのスケジュールされたタスクをクリーンに削除し、主要なシステム設定を復元します。

**可逆性に関する注意：** アンインストールは、スケジュールされたタスクを削除するだけではありません。また、主要なシステム設定をデフォルトの状態に戻し、クリーンなシステムを提供します。
*   Windows 更新が再度有効になります。
*   高速スタートアップが再度有効になります。
*   OneDrive をブロックするポリシーが削除されます。
*   スクリプトは自動ログインを無効にするオプションを提供します。

したがって、システムは残りの変更なしに標準のワークステーションに戻ります。

---

## ライセンスと貢献
このプロジェクトは **GPLv3** ライセンスの下で配布されています。全文は `LICENSE` ファイルで入手できます。

バグ報告、改善提案、プルリクエストのいずれの形式でも、貢献は歓迎されます。
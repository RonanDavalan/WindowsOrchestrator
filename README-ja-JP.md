# WindowsAutoConfig ⚙️

[🇫🇷 Français](README-fr-FR.md) | [🇺🇸 English](README.md) | [🇩🇪 Deutsch](README-de-DE.md) | [🇪🇸 Español](README-es-ES.md) | [🇮🇳 हिंदी](README-hi-IN.md) | [🇷🇺 Русский](README-ru-RU.md) | [🇨🇳 中文](README-zh-CN.md)

**専用Windowsワークステーションのための自動操縦システム。一度設定すれば、システムは信頼性高く自己管理します。**

![ライセンス](https://img.shields.io/badge/Licence-GPLv3-blue.svg)
![PowerShellバージョン](https://img.shields.io/badge/PowerShell-5.1%2B-blue)
![ステータス](https://img.shields.io/badge/Statut-Opérationnel-brightgreen.svg)
![OS](https://img.shields.io/badge/OS-Windows_10_|_11-informational)
![貢献](https://img.shields.io/badge/Contributions-Bienvenues-brightgreen.svg)

---

## 🎯 WindowsAutoConfig マニフェスト

### 問題
単一のタスク（インタラクティブキオスク、デジタルサイネージ、コマンドポストなど）のためにWindowsコンピューターを展開・維持することは、絶え間ない課題です。不適切なアップデート、予期せぬスリープ、再起動後にアプリケーションを手動で再起動する必要性...あらゆる詳細が故障の原因となり、時間のかかる手動介入が必要になる可能性があります。各ワークステーションを構成する作業は、反復的で時間がかかり、エラーが発生しやすいプロセスです。

### 解決策：WindowsAutoConfig
**WindowsAutoConfig** は、あらゆるWindows PCを信頼性と予測可能性の高い自動化システムに変えます。これは、ローカルにインストールするスクリプトのセットであり、システム構成を制御して、マシンが24時間年中無休で期待どおりに動作することを保証します。

それは恒久的な監視者として機能し、起動ごと、ログインごとにルールを適用するため、もう手動で操作する必要はありません。

## ✨ 主な機能
*   **グラフィカル設定ウィザード：** 基本設定のためにファイルを編集する必要はありません。
*   **電源管理：** マシンのスリープ、ディスプレイのスリープ、Windows高速スタートアップを無効にして、最大限の安定性を確保します。
*   **自動ログイン (Auto-Login)：** 安全なパスワード管理のために **Sysinternals AutoLogon** ツールと連携して自動ログインを管理します。
*   **Windows Update制御：** 強制的なアップデートや再起動がアプリケーションの動作を妨げるのを防ぎます。
*   **プロセス管理：** セッションごとにメインアプリケーションを自動的に起動、監視、再起動します。
*   **毎日計画再起動：** システムの新鮮さを保つために毎日再起動をスケジュールします。
*   **再起動前アクション：** 計画再起動の前にカスタムスクリプト（バックアップ、クリーンアップなど）を実行します。
*   **詳細なログ記録：** すべてのアクションは診断を容易にするためにログファイルに記録されます。
*   **通知（オプション）：** Gotify経由でステータスレポートを送信します。

---

## 🚀 インストールと利用開始
**WindowsAutoConfig** のセットアップは、シンプルでガイド付きのプロセスです。

1.  構成するコンピューターにプロジェクトを**ダウンロード**またはクローンします。
2.  `1_install.bat` を実行します。スクリプトは2つのステップで案内します。
    *   **ステップ1：グラフィカルウィザードによる設定。**
        必要に応じてオプションを調整します。最も重要なのは、通常、自動ログイン用のユーザーIDと起動するアプリケーションです。`保存`をクリックして保存します。
    *   **ステップ2：システムタスクのインストール。**
        スクリプトは続行の確認を求めます。Windowsセキュリティ（UAC）ウィンドウが開きます。必要なスケジュールされたタスクを作成するために、**これを受け入れる必要があります**。
3.  完了です！次回の再起動時に、設定が適用されます。

---

## 🔧 設定
設定はいつでも2つの方法で調整できます。

### 1. グラフィカルウィザード（簡単な方法）
`1_install.bat` を再実行して、設定インターフェースを再度開きます。設定を変更して保存します。

### 2. `config.ini` ファイル（高度な方法）
テキストエディタで `config.ini` を開き、詳細に制御します。

#### 自動ログインとパスワードに関する重要な注意
セキュリティ上の理由から、**WindowsAutoConfig はパスワードを平文で管理または保存することはありません。** ここでは、効果的かつ安全に自動ログインを構成する方法を説明します。

*   **シナリオ1：ユーザーアカウントにパスワードがない場合。**
    グラフィカルウィザードまたは `config.ini` ファイルの `AutoLoginUsername` にユーザー名を入力するだけです。

*   **シナリオ2：ユーザーアカウントにパスワードがある場合（推奨方法）。**
    1.  Microsoftの公式ツール **[Sysinternals AutoLogon](https://download.sysinternals.com/files/AutoLogon.zip)** をダウンロードします（直接ダウンロードリンク）。
    2.  AutoLogon を起動し、ユーザー名、ドメイン、パスワードを入力します。このツールはパスワードをレジストリに安全に保存します。
    3.  **WindowsAutoConfig** の設定では、`AutoLoginUsername` フィールドを空白のままにするか（スクリプトはAutoLogonによって設定されたユーザーを検出します）、または確実にするために記入することもできます。当社のスクリプトは、`AutoAdminLogon` レジストリキーが正しく有効になっていることを確認して、設定を完了します。

#### 高度な設定：`PreRebootActionCommand`
この強力な機能を使用すると、毎日の再起動前にスクリプトを実行できます。パスは次のいずれかになります。
- **絶対パス：** `C:\Scripts\my_backup.bat`
- **プロジェクト相対パス：** `PreReboot.bat`（スクリプトはこのファイルをプロジェクトのルートで探します）。
- **`%USERPROFILE%` を使用：** `%USERPROFILE%\Desktop\cleanup.ps1`（スクリプトは `%USERPROFILE%` を自動ログインユーザーのプロファイルパスにインテリジェントに置き換えます）。

---

## 📂 プロジェクト構造
```
WindowsAutoConfig/
├── 1_install.bat                # インストールと設定のエントリポイント
├── 2_uninstall.bat              # アンインストールのエントリポイント
├── config.ini                   # 中央設定ファイル
├── config_systeme.ps1           # マシン設定用のメインスクリプト（起動時に実行）
├── config_utilisateur.ps1       # ユーザープロセス管理用のメインスクリプト（ログイン時に実行）
├── PreReboot.bat                # 再起動前アクションのスクリプト例
├── Logs/                        # （自動作成）ログファイルが含まれています
└── management/
    ├── firstconfig.ps1          # グラフィカル設定ウィザードのコード
    ├── install.ps1              # タスクインストール用の技術スクリプト
    └── uninstall.ps1            # タスク削除用の技術スクリプト
```

---

## ⚙️ 詳細な動作
**WindowsAutoConfig** の核心は、Windowsタスクスケジューラに依存しています。

1.  **Windows起動時**
    *   `WindowsAutoConfig_SystemStartup` タスクは `SYSTEM` 権限で実行されます。
    *   `config_systeme.ps1` スクリプトは `config.ini` を読み取り、すべてのマシン設定を適用します。また、再起動タスクの作成/更新も管理します。

2.  **ユーザーログイン時**
    *   `WindowsAutoConfig_UserLogon` タスクが実行されます。
    *   `config_utilisateur.ps1` スクリプトは `config.ini` の `[Process]` セクションを読み取り、メインアプリケーションが正しく起動していることを確認します。すでに実行中の場合は、一度停止してからクリーンに再起動されます。

3.  **毎日（設定されている場合）**
    *   `WindowsAutoConfig_PreRebootAction` タスクは、バックアップ/クリーンアップスクリプトを実行します。
    *   数分後、`WindowsAutoConfig_ScheduledReboot` タスクがコンピューターを再起動します。

---

### 🛠️ 診断ツール

このプロジェクトには、複雑なアプリケーションの設定に役立つスクリプトが含まれています。

*   **`management/tools/Find-WindowInfo.ps1`**: 新しいアプリケーションの再起動前アクションを設定する必要があるが、そのウィンドウの正確なタイトルがわからない場合に、このツールが役立ちます。アプリケーションを起動した後、PowerShellコンソールでこのスクリプトを実行します。これにより、表示されているすべてのウィンドウとそのプロセス名がリストされ、`Close-AppByTitle.ps1` スクリプトで使用する正確なタイトルを見つけることができます。

---

## 📄 ログ記録 (Logging)
簡単なトラブルシューティングのために、すべてがログに記録されます。
*   **場所：** `Logs/` サブフォルダ内。
*   **ファイル：** `config_systeme_ps_log.txt` と `config_utilisateur_log.txt`。
*   **ローテーション：** 古いログは、サイズが大きくなりすぎないように自動的にアーカイブされます。

---

## 🗑️ アンインストール
システムを削除するには：
1.  `2_uninstall.bat` を実行します。
2.  **権限昇格の要求 (UAC) を受け入れます**。
3.  スクリプトは、プロジェクトによって作成されたすべてのスケジュールされたタスクをきれいに削除します。

**注：** アンインストールしてもシステム変更（例：スリープが無効のままになるなど）は元に戻されず、プロジェクトフォルダも削除されません。

---

## ❤️ ライセンスと貢献
このプロジェクトは **GPLv3** ライセンスの下で配布されています。全文は `LICENSE` ファイルで確認できます。

バグ報告、改善提案、プルリクエストなど、あらゆる形の貢献を歓迎します。
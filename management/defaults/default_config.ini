;================================================================================================
; MAIN CONFIGURATION FILE OF WINDOWSORCHESTRATOR
;================================================================================================
;
; WARNING: This file controls the critical behavior of the system and applications.
; Modify these settings with caution. An incorrect configuration can lead to
; unexpected system behavior (e.g., failure to launch the main application).
;
; SYNTAX:
;   - Lines beginning with a semicolon (;) are comments and are ignored.
;   - Boolean values must be 'true' or 'false'.
;   - To disable a feature (e.g., scheduled reboot), leave its value empty.
;
;================================================================================================

[SystemConfig]
;------------------------------------------------------------------------------------------------
; Manages operating system-level settings: startup, updates, session.
;------------------------------------------------------------------------------------------------

;--- USER SESSION MANAGEMENT ---
; ; Username for the session.
; If SessionStartupMode is Standard or Autologon, this is the user who will connect.
; If empty, the script will use the user who runs the installation.
AutoLoginUsername=

; Defines how the user session and the main application start.
;   Standard: Default Windows behavior (manual logon screen). The app starts after logon.
;   Autologon: Logs on the user automatically and shows the desktop. The app starts after logon.
SessionStartupMode=Autologon

;--- POWER AND STARTUP MANAGEMENT ---
; Disable Windows Fast Startup.
;   true : (Recommended) Disables "fast startup" to ensure a full and more stable reboot.
;   false : Lets Windows manage this setting.
DisableFastStartup=true

; Disable computer sleep.
;   true : Prevents the system from entering sleep or hibernate mode (S3/S4). Useful for systems that must remain active.
;   false : Allows sleep according to Windows settings.
DisableSleep=true

; Disable screen sleep.
;   true : Prevents the screen from turning off after a period of inactivity.
;   false : Allows the screen to sleep.
DisableScreenSleep=false

;--- UPDATES AND REBOOTS MANAGEMENT ---
; Complete disabling of the Windows Update service.
;   true : The Windows Update service is disabled, preventing automatic updates.
;   false : The Windows Update service is allowed to run normally.
DisableWindowsUpdate=false

; This variable is only usefull if you are choosed false to previous variable
; Prevents Windows from automatically rebooting after an update.
;   true : Prevents forced reboot if a user is logged on.
;   false : Allows Windows to reboot automatically.
DisableAutoReboot=true

;--- SYSTEM APPLICATIONS AND SERVICES ---
; Defines how to manage OneDrive.
;   Ignore: The orchestrator takes no action.
;   Close: The orchestrator closes the OneDrive.exe process if it's running.
;   Block: The orchestrator uses a system policy to prevent OneDrive from running.
OneDriveManagementMode=Close

[Process]
;------------------------------------------------------------------------------------------------
; Manages the launch, monitoring, and scheduled closing of the main application.
;------------------------------------------------------------------------------------------------

; --- SECTION: SCHEDULED CLOSURE (User Session) ---
; Enable or disable the scheduled closure task.
EnableScheduledClose=true

; Time (HH:MM) to execute the closure.
; Required if EnableScheduledClose is set to true.
ScheduledCloseTime=02:55

; Path to the script or executable used to close the application.
; Example: management\Close-AppByTitle.ps1
ScheduledCloseCommand="management\Close-AppByTitle.ps1"

; Optional arguments for the closure command.
; Leave empty if no arguments are needed.
ScheduledCloseArguments=

;--- SCHEDULED ACTION DAILY REBOOT (System Session) ---
; Enable or disable the daily reboot logic.
EnableScheduledReboot=true

; Time (HH:MM) for the daily reboot.
; - If set (e.g., 03:00): The system creates a specific task at this time.
; - If empty: The system will reboot automatically right after the backup finishes.
;   (If Backup is disabled, it will reboot automatically after the delay defined below).
ScheduledRebootTime=

; --- SECTION APPLICATION MANAGEMENT ---
; Command or script to launch the application.
ProcessToLaunch="LaunchApp.bat"

; Arguments for the application.
ProcessArguments=

; Name of the process to monitor (without .exe).
; This is the SINGLE SOURCE OF TRUTH for monitoring and closing the app.
; Example: Allv023-08
ProcessToMonitor=Allv023-05

; Select the type of window used to launch the application:
; - Standard: Uses the modern Windows terminal (Recommended).
; - Legacy: Forces the old black 'cmd.exe' window. Use this ONLY if the app crashes or doesn't show up.
LaunchConsoleMode=Standard

; Set to true to start the application minimized (hidden in taskbar).
StartProcessMinimized=false

; --- SECTION WATCHDOG MONITORING (Advanced) ---
; How often (in seconds) the system checks if the app is still running before backing up.
MonitorCheckInterval=5

; How long (in seconds) the system waits for the app to close before giving up.
MonitorTimeout=300

; If true, the system will FORCE close the app if it's stuck after the timeout.
; WARNING: This might cause data loss if the app was still writing.
ForceKillOnTimeout=false

; --- SECTION SAFETY BRIDGE ---
; Delay (in minutes) to wait before rebooting if the Backup is disabled.
; This gives the application time to close properly on its own.
RebootBridgeDelay=5

[DatabaseBackup]
;------------------------------------------------------------------------------------------------
; Manages the automatic backup of database files before the daily reboot.
;------------------------------------------------------------------------------------------------

; Set to true to enable the backup of recently modified files.
EnableBackup=false

; Time (HH:MM) to execute the backup.
; If empty (and EnableBackup=true): Calculated automatically (Closure Time + 5min) to sync with Watchdog.
ScheduledBackupTime=

; Source folder containing the database files to monitor.
; Relative paths are resolved from the script's location.
DatabaseSourcePath=..\data

; Destination folder where the backups will be stored.
DatabaseDestinationPath=..\data\BackupDaily

; Defines how many days backups are kept. Older archives are automatically deleted.
DatabaseKeepDays=30


[Installation]
;------------------------------------------------------------------------------------------------
; Manages installation and uninstallation behavior.
;------------------------------------------------------------------------------------------------

; Skip the EULA consent prompt for the Autologon tool.
;   true : Skips the EULA display and consent dialog, assuming acceptance for automated deployments.
;          WARNING: Setting this to true implies legal acceptance of the Microsoft Sysinternals Autologon EULA.
;          Use only in environments where EULA acceptance is pre-approved.
;   false: Displays the EULA and requires user consent (default, secure behavior).
SkipEulaPrompt=false

; Automatically reboot the system upon completion of installation or uninstallation.
;   true : A reboot is initiated to ensure all system changes are correctly applied.
;   false: The automatic reboot is suppressed (useful for development and testing).
RebootOnCompletion=false

; Grace period in seconds before the reboot is forced.
; This value is only used if RebootOnCompletion is set to true.
RebootGracePeriod=15

; Manages the exit behavior of the PowerShell window when RebootOnCompletion is false.
;   manual: The window waits for the user to press Enter (default).
;   automatic: The window closes automatically after the specified delay.
PowerShellExitMode=automatic

; Delay in seconds before the PowerShell window closes in 'automatic' mode.
PowerShellExitDelay=15

; Use the assistant to configure the Microsoft Autologon tool.
; This is only effective if SessionStartupMode is set to 'Autologon'.
UseAutologonAssistant=true

; Controls the visibility of optional, context-specific information messages in the Graphical User Interface (GUI).
; These messages provide operational context (e.g., the optimization note for Allv023-05).
;   true: (Default) Displays all contextual guidance messages in the configuration wizard.
;   false: Hides all optional context messages for a cleaner, generic production GUI.
ShowContextMessages=true

; Hides the PowerShell console window during installation/uninstallation.
;   true : The console window is hidden. Ideal for end-user deployments.
;          All output is still logged to files in the Logs/ folder.
;          A MessageBox notification will appear at the end to inform of success/failure.
;   false: (Default) The console window remains visible. Useful for development and debugging.
; NOTE: The graphical interface (firstconfig.ps1) remains always visible regardless of this setting.
SilentMode=true

; URL for downloading the Autologon tool.
; Only change this if the official link from Microsoft is broken or updated.
AutologonDownloadUrl=https://live.sysinternals.com/files/AutoLogon.zip


[Logging]
;------------------------------------------------------------------------------------------------
; Manages the behavior of log files (logs).
;------------------------------------------------------------------------------------------------

; Enables or disables log rotation to prevent them from becoming too large.
;   true : Old logs are archived (log.txt -> log.1.txt) at each launch.
;   false : A single log file is used and grows indefinitely.
EnableLogRotation=true

; Maximum number of log files to keep for the system script.
; Includes the current log and archives. '7' means keeping the logs for the last 7 days.
MaxSystemLogsToKeep=7

; Maximum number of log files to keep for the user script.
MaxUserLogsToKeep=7


[Gotify]
;------------------------------------------------------------------------------------------------
; Manages sending status notifications via a Gotify server. (Optional)
;------------------------------------------------------------------------------------------------

; Enables or disables Gotify notifications.
EnableGotify=false

; Base URL of your Gotify instance.
Url=

; Token of the application created in Gotify for sending messages.
Token=

; Priority of Gotify messages (an integer).
Priority=1

; Notification titles. You can use the %COMPUTERNAME% and %USERNAME% variables.
GotifyTitleSuccessSystem=%COMPUTERNAME% System
GotifyTitleErrorSystem=ERROR System Configuration on %COMPUTERNAME%
GotifyTitleSuccessUser=%COMPUTERNAME% %USERNAME%
GotifyTitleErrorUser=ERROR User Configuration %USERNAME% on %COMPUTERNAME%
